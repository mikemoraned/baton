<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Animations</title>
    <style type="text/scss">
      @import "constants";
      @import "definitions";
      @include define-grid(33, 33);
    </style>
  </head>
  <body>
    <div class="qrcode" id="parent"></div>
    <script type="module">
      import shuffle from "shuffle-array";
      import qrcode from "qrcode-generator";

      const typeNumber = 4;
      const errorCorrectionLevel = "L";
      const qr = qrcode(typeNumber, errorCorrectionLevel);
      qr.addData("Hello world");
      qr.make();

      const parent = document.getElementById("parent");
      function cell(fromFill, toFill, fromX, fromY, toX, toY) {
        const node = document.createElement("div");
        node.setAttribute(
          "class",
          `cell ${fromFill ? "filled" : "empty"} to-${
            toFill ? "filled" : "empty"
          } x${fromX} y${fromY} to-x${toX} to-y${toY}`
        );
        node.appendChild(document.createTextNode(fromFill ? "#" : "."));
        return node;
      }
      const width = qr.getModuleCount();
      const height = qr.getModuleCount();

      const reifiedFrom = [];
      const reifiedTo = [];
      for (let x = 0; x < width; x++) {
        for (let y = 0; y < height; y++) {
          const filled = qr.isDark(y, x);
          reifiedFrom.push({ x, y });
          reifiedTo.push({ x, y, filled });
        }
      }
      shuffle(reifiedFrom);
      for (let i = 0; i < reifiedFrom.length; i++) {
        parent.appendChild(
          cell(
            reifiedTo[i].filled,
            reifiedTo[i].filled,
            reifiedFrom[i].x,
            reifiedFrom[i].y,
            reifiedTo[i].x,
            reifiedTo[i].y
          )
        );
      }
    </script>
  </body>
</html>
